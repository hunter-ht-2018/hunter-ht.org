<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="decription" content="personalpage">
    <meta name="author" content="liuyingying">
    <title>index</title>
    <link rel="stylesheet" href="../static/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../static/css/index.css">
    <script src="../static/js/jquery-1.9.1.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top " role="navigation">
      <div class="width-limit">
        <!-- logo on left -->
        <a class="navbar-brand nav-title logo" href="#">HUNTER</a>
        <!-- logo on right -->
          <a class="logout" onclick="logout()">EXIT</a>
        <div title="查看与编辑我的信息" id="username"></div>
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu" aria-expanded="false">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
          </div>
          <div class="collapse navbar-collapse" id="menu">
            <ul class="nav navbar-nav">
              <li class="tab">
                <a href="#" onclick="showPub()">
                  <span class="menu-text">Publications</span>
                </a>
              </li>
              <li class="tab">
                <a href="#" onclick="showArt()">
                  <span class="menu-text">Articles</span>
                </a>
              </li>
              <li class="tab">
                <a href="#" onclick="showUpload()">
                  <span class="menu-text">Upload</span>
                </a>
              </li>
              <li>
                <a href="/write/" target="_blank">Write</a>
              </li>

            </ul>
          </div>
        </div>
      </div>
    </nav>
    <div class="content-two container content-border">
        <section id="publications" class="list">
            <table class="table tableList">
              <thead>
                
              </thead>
              <tbody>
                  {%  for publication in publications  %}
                  <tr>
                      <td class="col-sm-2 col-md-2">
                          {{ publication.publishType }}
                          <br>
                          {{ publication.date }}
                      </td>
                      <td class="col-sm-10 col-md-10 col-md-offset-2">
                          <p><a href=../{{ publication.link }} target="_blank">{{ publication.title }}</a></p>
                          <p>{{ publication.authors }}</p>
                          <p>{{ publication.journalname }} {{publication.index}}</p>
                      </td>

                  </tr>
                  {%  endfor %}
              </tbody>
            </table>
        </section>
        <section id="articles" class="list move-pub">
          <ul id="articleList" class="node-list">

          </ul>
        </section>
        <section id="upload" class="list move-pub">
            <div class="uploadForm" >
                <form class="form-horizontal" role="form" action="/index/" method="post" enctype="multipart/form-data" >
                    <div class="form-group">
                        <label class="col-sm-2 control-label">作者</label>
                        <div class="col-sm-10 control-input">
                            <input type="text" class="form-control" placeholder="Example:Tom,Bob,Jane" name="authors" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">标题</label>
                        <div class="col-sm-10 control-input">
                            <input type="text"  class="form-control"  name="title" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">文件</label>
                        <div class="col-sm-10 control-input">
                            <input type="file" name="myfile" required>
                        </div>
                    </div>
                    <div class="form-group">
{#                        <label class="col-sm-2 control-label">名称</label>#}
                        <select class="col-sm-2 control-select" name="type">
                            <option value="0">请选择</option>
                            <option value="会议">会议</option>
                            <option value="期刊">期刊</option>
                            <option value="专利">专利</option>
                            <option value="软著">软著</option>
                        </select>
                        <div class="col-sm-10 control-input">
                            <input type="text" class="form-control"  name="journalname" placeholder="名称" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">日期</label>
                        <div class="col-sm-10 control-input">
                            <input type="text" class="form-control" placeholder="示例：2018-08-08"  name="date" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">检索类型</label>
                        <div class="col-sm-10 control-input">
                            <input type="text" class="form-control" name="index" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10 upload-btn">
                            <button type="submit" class="btn btn-default">提交</button>
					        <p id="uploadError" style="color:red;">{{ uploadError }}</p><p id="uploadMessage" style="color:red;">{{ uploadMessage }}</p>
                        </div>
                    </div>
                </form>
	        </div>
        </section>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            getUsername();
            var uploadMessage = document.getElementById("uploadMessage").innerHTML;
            if(uploadMessage!=null&&uploadMessage!=""){
                alert(uploadMessage);
            }
            var uploadError = document.getElementById("uploadError").innerHTML;
            if(uploadError!=null&&uploadError!=""){
                alert("数据库错误，请联系管理员");
            }
        });
        function getDataShow() {
            var storage=window.sessionStorage;
            var username=storage.username;
            $.ajax({
                url: '/index/',
                type: 'get',
                data:{
                    "user":username,
                },
                success: function (response,status,xhr) {
                    $("#articleList").empty();
                    $.each($.parseJSON(response),function(i,item){
                        var article = item.fields;
                        var arttit =article.title.length>50? article.title.substring(0,50)+'...':article.title;
                        var artCnt = article.content.length>100? article.content.substring(0,100)+'...':article.content;
                        var isPublished = article.publish=='1'? "已发布":"未发布"
                        var articleHTML = '<li>\n' +
                            '              <div class="article-content">\n' +
                            '                  <a class="title" target="_blank" href="/view/?title='+article.title+'">'+arttit+'</a><br>\n' +
                            '                  <p class="abstract">'+artCnt+'</p>\n' +
                            '                  <span>'+isPublished+'</span>'+
                                '<span>'+article.editDateTime+'</span>'+
                            '                  <a class="editbtn" title="编辑" target="_blank" href="/write/?title='+article.title+'"><?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1538270903865" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3673" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M607.232 896a32 32 0 1 1 0 64H192a96 96 0 0 1-96-96V160a96 96 0 0 1 96-96h544a96 96 0 0 1 96 96 32 32 0 0 1-64 0 32 32 0 0 0-32-32H192a32 32 0 0 0-32 32v704a32 32 0 0 0 32 32h415.232zM832 585.76v146.656c0 42.656-64 42.656-64 0v-146.656c0-42.688 64-42.688 64 0z" p-id="3674" fill="#ea6f5a"></path><path d="M288 320a32 32 0 1 1 0-64h224a32 32 0 0 1 0 64H288zM288 480a32 32 0 0 1 0-64h128a32 32 0 0 1 0 64H288zM639.424 926.592a32 32 0 1 1-64 0L576 800a96 96 0 0 1 96-96l127.744 1.152a32 32 0 1 1 0 64L672 768a32 32 0 0 0-32 32l-0.576 126.592z" p-id="3675" fill="#ea6f5a"></path><path d="M637.92 947.648a32 32 0 1 1-44.32-46.208l180.384-172.992a32 32 0 1 1 44.288 46.176l-180.352 173.024zM880.896 334.528a31.424 31.424 0 0 0 3.328-44.416l-0.416-0.512a32 32 0 0 0-44.896-3.36L408.32 652.288l-15.2 51.84 58.336-4.544 429.44-365.056z m51.616-86.4a95.36 95.36 0 0 1-9.408 134.496l-438.08 372.448a32 32 0 0 1-18.24 7.52l-114.944 8.896a32 32 0 0 1-33.184-40.928l30.944-105.472a32 32 0 0 1 9.984-15.36L797.408 237.504a96 96 0 0 1 134.688 10.112l0.416 0.512z" p-id="3676" fill="#ea6f5a"></path></svg></a>\n' +
                            '                  <button class="delebtn" title="删除" onclick="deleteArt(this)"><?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1539054739914" class="icon"  style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2718" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M861.012317 164.091494C765.809507 68.885661 639.229448 16.455901 504.590713 16.455901S243.372927 68.885661 148.170117 164.091494C52.965291 259.293296 0.534525 385.874363 0.534525 520.51209c0 134.639743 52.430767 261.217786 147.635592 356.422612 95.20281 95.20281 221.782869 147.633577 356.420596 147.633577s261.217786-52.430767 356.420596-147.633577c95.204825-95.204825 147.635592-221.783877 147.635592-356.422612C1008.646902 385.874363 956.217143 259.293296 861.012317 164.091494zM791.219829 810.54584c-4.394084 4.393077-10.152441 6.590623-15.910797 6.590623-5.759364 0-11.518728-2.197546-15.911805-6.590623L504.590713 555.740334 249.785207 810.54584c-4.394084 4.393077-10.152441 6.590623-15.911805 6.590623-5.758356 0-11.516713-2.197546-15.910797-6.590623-8.788169-8.788169-8.788169-23.036448 0-31.824617L472.767104 523.916725 219.336953 270.485566c-8.788169-8.788169-8.788169-23.036448 0-31.824617 8.788169-8.785146 23.035441-8.785146 31.823609 0l253.431158 253.431158 253.431158-253.431158c8.788169-8.785146 23.035441-8.785146 31.823609 0 8.788169 8.788169 8.788169 23.036448 0 31.824617L536.41533 523.916725l254.804499 254.805506C800.007998 787.509392 800.007998 801.757672 791.219829 810.54584z" p-id="2719" fill="#ea6f5a"></path></svg></button>\n' +
                            '              </div>\n' +
                            '            </li>'
                        $("#articleList").append(articleHTML);
                    });
                },
                error: function (xhr) {
                    console.error('Something went wrong...');
                }
            });
        }
        function deleteArt(thisbtn){
            var title = thisbtn.parentElement.firstElementChild.innerHTML;
            $.ajax({
                url:'/index/',
                type:'post',
                data:{
                    "title":title,
                },
                success:function(response){
                    if (response["warning"]=="文章删除成功"){
                        thisbtn.parentElement.parentElement.remove();
                    }else{
                        alert(response["warning"]);
                    }
                },
                error:function (xhr) {
                    console.error('something went wrong...');
                }
            })
        }
        function uploadFile(url, data){
            $.ajax({
                url: url,
                type: 'post',
                data:{
                    "authors":data["authors"],
                    "title":data["title"],
                    "myfile":data["myfile"],
                    "journalname":data["journalname"],
                    "date":data["date"],
                    "index":data["index"],
                },
                processData : false,
                contentType : false,
                dataType: 'json',
                success: function (msg) {
                    $("#uploadMessage").text(msg["warning"]);
                },
                error: function (xhr) {
                    console.error('Something went wrong....');
                }
            });
        }

        function getUsername(){
            var storage=window.sessionStorage;
            var username=storage.username;
            if(username != null&&username.toString().length>0){
                var usernameHTMl='<a target="_blank" href="/edit/'+username+'.html">'+username+'</a>';
                document.getElementById('username').innerHTML=usernameHTMl;
            }else{
                alert("请先登录");
                window.location.href="/signin/";
            }
        }

        function logout() {
            var storage = window.sessionStorage;
            storage.clear();
            window.location.href="/signin/";
        }

        function GetQueryString(name)
        {
             var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
             var r = window.location.search.substr(1).match(reg);
             if(r!=null){
                 return unescape(r[2]);
             }
             return null;
        }
      function showPub(){
        $("#publications").hasClass("move-pub")?$("#publications").removeClass("move-pub"):1==1;
        $("#articles").hasClass("move-pub")?1==1:$("#articles").addClass("move-pub");
        $("#upload").hasClass("move-pub")?1==1:$("#upload").addClass("move-pub");
      }
      function showArt(){
        $("#publications").hasClass("move-pub")?1==1:$("#publications").addClass("move-pub");
        $("#articles").hasClass("move-pub")?$("#articles").removeClass("move-pub"):1==1;
        $("#upload").hasClass("move-pub")?1==1:$("#upload").addClass("move-pub");
        getDataShow();
      }
      function showUpload(){
        $("#publications").hasClass("move-pub")?1==1:$("#publications").addClass("move-pub");
        $("#articles").hasClass("move-pub")?1==1:$("#articles").addClass("move-pub");
        $("#upload").hasClass("move-pub")?$("#upload").removeClass("move-pub"):1==1;
      }
    </script>
    
    <script src="../static/bootstrap-4.0.0/assets/js/vendor/popper.min.js"></script>
    <script src="../static/bootstrap-4.0.0/dist/js/bootstrap.min.js"></script>
    <script src="../static/bootstrap-4.0.0/assets/js/vendor/holder.min.js"></script>
</body>
</html>